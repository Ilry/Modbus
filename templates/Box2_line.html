<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>index</title>

    <script src='../static/js/vue.min.js'></script>
    <script src="https://unpkg.com/vue"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@4.1.0/dist/echarts.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-echarts@4.0.2"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css" />

    <link rel="stylesheet" href="../static/css/index1.css" type="text/css" />
</head>

<body>
    <div id="app">
        <el-container style="height: 740px; border: 1px solid #eee">
            <el-aside width="200px" style="background-color:#545c64">
                <el-menu :default-opened="['1','5']" background-color="#545c64" text-color="#fff"
                    active-text-color="#ffd04b" :unique-opened="true">
                    <el-submenu index="1">
                        <template slot="title"><i class="el-icon-office-building"></i>发酵罐一</template>
                        <el-submenu index="1-1">
                            <template slot="title"><i class="el-icon-menu"></i>历史数据显示</template>
                            <el-menu-item index="1-1-1">
                                <i class="el-icon-tickets"></i>
                                <a @click="Box1_table">表格</a>
                            </el-menu-item>
                            <el-menu-item index="1-1-2">
                                <i class="el-icon-data-line"></i>
                                <a @click="Box1_line">折线图</a>
                            </el-menu-item>
                        </el-submenu>
                        <el-menu-item index="1-2">
                            <i class="el-icon-stopwatch"></i>
                            <a @click="Box1_chart">仪表盘</a>
                        </el-menu-item>
                        <el-menu-item index="1-3">
                            <i class="el-icon-s-tools"></i>
                            <a @click="Box1_operation">控制发酵罐</a>
                        </el-menu-item>
                    </el-submenu>
                    <el-submenu index="2">

                        <template slot="title"><i class="el-icon-office-building"></i>发酵罐二</template>
                        <el-submenu index="2-1">
                            <template slot="title"><i class="el-icon-menu"></i>历史数据显示</template>
                            <el-menu-item index="2-1-1">
                                <i class="el-icon-tickets"></i>
                                <a @click="Box2_table">表格</a>
                            </el-menu-item>
                            <el-menu-item index="2-1-2">
                                <i class="el-icon-data-line"></i>
                                <a @click="Box2_line">折线图</a>
                            </el-menu-item>
                        </el-submenu>
                        <el-menu-item index="2-2">
                            <i class="el-icon-stopwatch"></i>
                            <a @click="Box2_chart">仪表盘</a>
                        </el-menu-item>
                        <el-menu-item index="2-3">
                            <i class="el-icon-s-tools"></i>
                            <a @click="Box2_operation">控制发酵罐</a>
                        </el-menu-item>
                    </el-submenu>
                    <el-submenu index="3">
                        <template slot="title"><i class="el-icon-office-building"></i>发酵罐三</template>
                        <el-submenu index="3-1">
                            <template slot="title"><i class="el-icon-menu"></i>历史数据显示</template>
                            <el-menu-item index="3-1-1">
                                <i class="el-icon-tickets"></i>
                                <a @click="Box3_table">表格</a>
                            </el-menu-item>
                            <el-menu-item index="3-1-2">
                                <i class="el-icon-data-line"></i>
                                <a @click="Box3_line">折线图</a>
                            </el-menu-item>
                        </el-submenu>
                        <el-menu-item index="3-2">
                            <i class="el-icon-stopwatch"></i>
                            <a @click="Box3_chart">仪表盘</a>
                        </el-menu-item>
                        <el-menu-item index="3-3">
                            <i class="el-icon-s-tools"></i>
                            <a @click="Box3_operation">控制发酵罐</a>
                        </el-menu-item>
                    </el-submenu>
                    <el-submenu index="4">
                        <template slot="title"><i class="el-icon-office-building"></i>发酵罐四</template>
                        <el-submenu index="4-1">
                            <template slot="title"><i class="el-icon-menu"></i>历史数据显示</template>
                            <el-menu-item index="4-1-1">
                                <i class="el-icon-tickets"></i>
                                <a @click="Box4_table">表格</a>
                            </el-menu-item>
                            <el-menu-item index="4-1-2">
                                <i class="el-icon-data-line"></i>
                                <a @click="Box4_line">折线图</a>
                            </el-menu-item>
                        </el-submenu>
                        <el-menu-item index="4-2">
                            <i class="el-icon-stopwatch"></i>
                            <a @click="Box4_chart">仪表盘</a>
                        </el-menu-item>
                        <el-menu-item index="4-3">
                            <i class="el-icon-s-tools"></i>
                            <a @click="Box4_operation">控制发酵罐</a>
                        </el-menu-item>
                    </el-submenu>
                    <el-menu-item index="5" @click="user_admin">
                        <template slot="title"><i class="el-icon-user"></i>用户管理</template>
                    </el-menu-item>
                </el-menu>
            </el-aside>
            <el-main>
                <div>

                    <div>
                        <el-row type="flex" justify='center'>
                            <el-col :span="12">
                                <v-chart :options="ce1" />
                            </el-col>
                        </el-row>
                    </div>
                    <div>
                        <el-row type="flex" justify='center'>
                            <el-col :span="12">
                                <v-chart :options="ce2" />
                            </el-col>
                        </el-row>
                    </div>
                    <div>
                        <el-row type="flex" justify='center'>
                            <el-col :span="12">
                                <v-chart :options="ce3" />
                            </el-col>
                        </el-row>
                    </div>
                </div>
            </el-main>
        </el-container>
    </div>
    <script type="text/javascript">
        var app = new Vue({
            el: '#app',
            components: {
                'v-chart': VueECharts
            },
            data() {
                return {
                    X: [],
                    PH: [],
                    CO2: [],
                    O2: [],
                    CH3CH2OH: [],
                    CH3CH2COOH: [],
                    pressure: [],
                    Box: {
                        'id': 0,
                        'PH': 0,
                        'CO2': 0,
                        'O2': 0,
                        'CH3CH2OH': 0,
                        'CH3CH2COOH': 0,
                        'pressure': 0,
                        'time': ''
                    },
                    ce1: {
                        title: {
                            text: '酸碱度',
                        },
                        tooltip: {
                            trigger: 'axis',
                            axisPointer: {
                                type: 'cross',
                                label: {
                                    backgroundColor: '#6a7985'
                                }
                            }
                        },
                        toolbox: {
                            feature: {
                                saveAsImage: {}
                            }
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '3%',
                            containLabel: true
                        },
                        legend: {
                            data: ['PH']
                        },
                        xAxis: [
                            {
                                type: 'category',
                                boundaryGap: false,
                                data: this.X,
                            }
                        ],
                        yAxis: {
                            type: 'value'
                        },
                        series: [{
                            name: 'PH',
                            data: this.PH,
                            type: 'line',
                            smooth: true,
                        }]
                    },
                    ce2: {
                        title: {
                            text: '各个物质浓度',
                        },
                        tooltip: {
                            trigger: 'axis',
                            axisPointer: {
                                type: 'cross',
                                label: {
                                    backgroundColor: '#6a7985'
                                }
                            }
                        },
                        toolbox: {
                            feature: {
                                saveAsImage: {}
                            }
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '3%',
                            containLabel: true
                        },
                        legend: {
                            data: ['CO2', 'O2', '酒精', '乙酸']
                        },
                        xAxis: [
                            {
                                type: 'category',
                                boundaryGap: false,
                                data: this.X,
                            }
                        ],
                        yAxis: [{
                            type: 'value'
                        }],
                        series: [{
                            name: 'CO2',
                            data: this.CO2,
                            type: 'line',
                            areaStyle: {},
                            emphasis: {
                                focus: 'series'
                            },
                            smooth: true
                        },
                        {
                            name: 'O2',
                            data: this.O2,
                            type: 'line',
                            areaStyle: {},
                            emphasis: {
                                focus: 'series'
                            },
                            smooth: true
                        },
                        {
                            name: '酒精',
                            data: this.CH3CH2OH,
                            type: 'line',
                            areaStyle: {},
                            emphasis: {
                                focus: 'series'
                            },
                            smooth: true
                        },
                        {
                            name: '乙酸',
                            data: this.CH3CH2COOH,
                            type: 'line',
                            areaStyle: {},
                            emphasis: {
                                focus: 'series'
                            },
                            smooth: true
                        },
                        ]
                    },
                    ce3: {
                        title: {
                            text: '压强'
                        },
                        tooltip: {
                            trigger: 'axis',
                            axisPointer: {
                                type: 'cross',
                                label: {
                                    backgroundColor: '#6a7985'
                                }
                            }
                        },
                        toolbox: {
                            feature: {
                                saveAsImage: {}
                            }
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '3%',
                            containLabel: true
                        },
                        legend: {
                            data: ['压强']
                        },
                        xAxis: [
                            {
                                type: 'category',
                                boundaryGap: false,
                                data: this.X,
                            }
                        ],
                        yAxis: {
                            type: 'value'
                        },
                        series: [{
                            name: '压强',
                            data: this.pressure,
                            type: 'line',
                            smooth: true
                        }],

                    },
                }
            },
            mounted() {

                setInterval(() => {
                    // this.data = [];
                    this.Box_1 = [];

                    axios
                        .get('/Box2')
                        .then(response => (this.Box = response.data))
                        .catch(function (error) { // 请求失败处理
                            console.log(error);
                        });
                    for (var i = this.Box.length - 100; i <= this.Box.length; i++) {
                        this.PH.push(this.Box[this.Box.length - i].PH)
                        this.time.push(this.Box[this.Box.length - i].time)
                        this.CO2.push(this.Box[this.Box.length - i].CO2)
                        this.CH3CH2COOH.push(this.Box[this.Box.length - i].CH3CH2COOH)
                        this.O2.push(this.Box[this.Box.length - i].O2)
                        this.CH3CH2OH.push(this.Box[this.Box.length - i].CH3CH2OH)
                        this.pressure.push(this.Box[this.Box.length - i].pressure)
                        this.X.unshift(this.Box.length - i)
                    }
                    this.ce1.series[0].data = this.PH
                    this.ce1.xAxis[0].data = this.X
                    this.ce2.series[0].data = this.CO2
                    this.ce2.series[1].data = this.O2
                    this.ce2.series[2].data = this.CH3CH2OH
                    this.ce2.series[3].data = this.CH3CH2COOH
                    this.ce2.xAxis[0].data = this.X
                    this.ce3.xAxis[0].data = this.X
                    this.ce3.series[0].data = this.pressure
                    this.X = [];
                    this.PH = [];
                    this.CO2 = [];
                    this.CH3CH2COOH = [];
                    this.CH3CH2OH = [];
                    this.O2 = [];
                    this.time = [];
                    this.pressure = [];

                }, 1000)

            },
            watch: {
                curpage: function (oldValue, newValue) {
                    console.log(arguments);
                }
            },
            methods: {
                Box1_table: function () {
                    location.href = '/Box1_table';
                },
                Box1_chart: function () {
                    location.href = '/Box1_chart';
                },
                Box1_operation: function () {
                    location.href = '/Box1_operation';
                },
                Box1_line: function () {
                    location.href = '/Box1_line';
                },
                Box2_table: function () {
                    location.href = '/Box2_table';
                },
                Box2_chart: function () {
                    location.href = '/Box2_chart';
                },
                Box2_operation: function () {
                    location.href = '/Box2_operation';
                },
                Box2_line: function () {
                    location.href = '/Box2_line';
                },
                Box3_table: function () {
                    location.href = '/Box3_table';
                },
                Box3_chart: function () {
                    location.href = '/Box3_chart';
                },
                Box3_operation: function () {
                    location.href = '/Box3_operation';
                },
                Box3_line: function () {
                    location.href = '/Box3_line';
                },
                Box4_table: function () {
                    location.href = '/Box4_table';
                },
                Box4_chart: function () {
                    location.href = '/Box4_chart';
                },
                Box4_operation: function () {
                    location.href = '/Box4_operation';
                },
                Box4_line: function () {
                    location.href = '/Box4_line';
                },
                user_admin: function () {
                    location.href = '/user_admin';
                },
            }
        })
    </script>
</body>

</html>